## Криминальное тестирование - Проект "Тарантино"

Создан в рамках хакатона BeCoder 2022

**http://83.222.10.235:5000**

---

## Зависимости
Большая часть проекта реализована на Python 3.10, поэтому все зависимости вынесены в один файл requirements.txt

**Для корректной работы модулей (в т.ч. catboost) необходима именно версия 3.10 (на 3.11 не работает!)**  

Для установки зависимостей:
```shell
pip install -r requirements.txt
```

## Модули
Проект разделен на 4 модуля:

1. **"Гит"** - Парсинг репозитория
2. **"Анализ"** - Расшифровка и преобразование полученных данных
2. **"МЛ"** - Модель для предсказания ошибочных коммитов
3. **"Веб"** - Интерфейс для взаимодействия с решением

## 1. "Гит" - Парсинг репозитория
Модуль для получения дерева коммитов и работы с ним. Для извлечения данных использовался GitPython
как универсальное решение для работы с git-репозиториями

### Что делает:
Последовательно получает список коммитов и файлов в них, начиная с первого (в хронологическом порядке) и далее
(в одном цикле) обновляет информацию о файлах: если коммит содержит строку `fix`, то все файлы в нём считаются починенными,
а предыдущие коммиты считаются "сломавшими" (поле `is_broken`)

В результате получатеся следующий JSON:

```json
[{
    "file": ".gitignore",
    "author": "Miko Hevery",
    "msg": "Initial commit",
    "date": 1411056721,
    "is_broken": false
},
{
    "file": "LICENSE",
    "author": "Miko Hevery",
    "msg": "Initial commit",
    "date": 1411056721,
    "is_broken": false
}]
```

Разбор реализован в `parse_git/parse_commits.py`

Для запуска необходимо указать в начале файла следующие переменные:

```python
NAME = "knockout" # Имя папки
GIT_URL = "https://github.com/knockout/knockout" # URL епозитория
BRANCH = "master" # Название ветки для парсинга
COMMITS_LIMIT = 5000 # Количество коммитов для анализа
```

## 2. "Анализ" - Расшифровка и преобразование полученных данных
Модуль агрегирует данные, полученные из первого модуля - содержит в себе много функций необходимых
для получения различной информации из сырых данных о коммитах и файлах

### Что делает:
- Собирает информацию для каждого автора по списку файлов и разбивает их по месяцам (для анализа)
- Считает количество ошибочных коммитов для авторов
- Ищет "ТОП" авторов с наибольшим количеством ошибок
- Строит графики зависимости коммитов от времени
- Ищет ревьюверов для заданного коммита (по наибольшему числу коммитов в конкретный файл)

Реализован в `analyse/main.py`

Для запуска (постоение графиков для ТОПа авторов по ошибкам) необходимо указать
путь до файла разбора git-репозитория, задается в переменной `url` (в концтрукции main) и запустить файл.

Для примера в репозитории присутствуют файлы git-разбора для репозиториев angular и knockout 


## 3. "МЛ" - Модель для предсказания ошибочных коммитов
Модель машинного обучения, основанная на Catboost

### Что делает:
1. Принимает информацию из "Гита"
2. Разбивает на обучающую и тестовую выборки
3. Обучает Catboost Classifier
4. Предсказывает вероятность ошибочного коммита для заданного автора, файла, даты и сообщения коммита
5. Сохраняет модель в файл

Реализован в `catboost_becoder/becoder.ipynb`  
Копия на Google Colab: https://colab.research.google.com/drive/1zbxzdox-N7a8bttgbp34BqtHRyuqs2Z_?usp=sharing

Для запуска необходимо отрыть блокнот в Google Colab или Jupyter Notebook и запустить все ячейки

В блокноте для удобства так же продублирован функционал из модуля "Гит" - для получения данных о коммитах

## 4. "Веб" - Интерфейс для взаимодействия с решением
Веб-интерфейс для быстрого взаимодействия с решением и демонстрации его работы


Демо: http://83.222.10.235:5000/

### Что делает:
- Позволяет ввести данные для предсказания вероятности ошибочного коммита
- Показывает результат предсказания
- Показывает рекомендуемого ревьюера для данных коммита

Реализован в `web` и `server.py`

Для автоматизированного запуска всё упаковано в docker-контейнер. Для запуска:
```shell
docker build -t becoder .
docker run -p 5000:5000 becoder
```

Для ручного запуска необходимо:
0. Установить NodeJS версии 16+
1. Установить зависимости фронтенда командой `npm install`
2. Собрать фронтенд командой `npm run build`
3. Скопировать содержимое папки `web/dist` в папку `static` в корне проекта
4. Запустить сервер командой `python server.py`
5. Открыть в браузере http://localhost:5000
